<launch>

    <arg name="arm" default="gen3"/>
    <arg name="dof" default="7" if="$(eval arg('arm') == 'gen3')"/>
    <arg name="vision" default="true"/>
    <arg name="gripper" default="" if="$(eval arg('arm') == 'gen3')"/>
    <arg name="gripper" default="gen3_lite_2f" if="$(eval arg('arm') == 'gen3_lite')"/>
    
    <arg name="robot_name" default="my_$(arg arm)"/> <arg name="prefix" default=""/>
    <arg name="cyclic_data_publish_rate" default="40"/> <arg name="ip_address" default="192.168.1.10"/> 

    <arg name="start_rviz" default="true"/>
    
    <arg name="use_sim_time" default="false"/>
    <param name="/use_sim_time" value="$(arg use_sim_time)"/>


    <group ns="$(arg robot_name)">

        <param name="robot_description" command="$(find xacro)/xacro --inorder $(find kortex_description)/robots/$(arg arm).xacro dof:=$(arg dof) vision:=$(arg vision) sim:=false prefix:=$(arg prefix)"
               if="$(eval not arg('gripper'))"/>
        <param name="robot_description" command="$(find xacro)/xacro --inorder $(find kortex_description)/robots/$(arg arm)_$(arg gripper).xacro dof:=$(arg dof) vision:=$(arg vision) sim:=false prefix:=$(arg prefix)"
               unless="$(eval not arg('gripper'))"/>

        <rosparam file="$(find kortex_control)/arms/$(arg arm)/$(arg dof)dof/config/joint_position_controllers.yaml" command="load" subst_value="true"/>
        <rosparam file="$(find kortex_control)/grippers/$(arg gripper)/config/gripper_action_controller_parameters.yaml" command="load" subst_value="true"
                  unless="$(eval not arg('gripper'))"/>

        <node name="$(arg prefix)$(arg arm)_trajectory_controller_spawner" pkg="controller_manager" type="spawner" respawn="false"
              output="screen" args="$(arg prefix)$(arg arm)_joint_trajectory_controller $(arg prefix)joint_state_controller"
              if="$(eval not arg('gripper'))"/>
        <node name="$(arg prefix)$(arg arm)_controller_spawner" pkg="controller_manager" type="spawner" respawn="false"
              output="screen" args="$(arg prefix)$(arg arm)_joint_trajectory_controller $(arg prefix)joint_state_controller $(arg prefix)$(arg gripper)_gripper_controller"
              unless="$(eval not arg('gripper'))"/>

        <node name="$(arg prefix)$(arg arm)_position_controllers_spawner" pkg="controller_manager" type="spawner" respawn="false"
              output="screen" if="$(eval arg('dof') == 6)" args=" --stopped
              $(arg prefix)joint_1_position_controller ... (其他关节) ... $(arg prefix)joint_6_position_controller"/>
        <node name="$(arg prefix)$(arg arm)_position_controllers_spawner" pkg="controller_manager" type="spawner" respawn="false"
              output="screen" if="$(eval arg('dof') == 7)" args=" --stopped
              $(arg prefix)joint_1_position_controller ... (其他关节) ... $(arg prefix)joint_7_position_controller"/>

        <node name="$(arg robot_name)_driver" pkg="kortex_driver" type="kortex_arm_driver" output="screen">
            
            <param name="sim" value="false"/> <param name="ip_address" value="$(arg ip_address)"/> <param name="cyclic_data_publish_rate" value="$(arg cyclic_data_publish_rate)"/>
            <param name="arm" value="$(arg arm)"/>
            <param name="gripper" value="$(arg gripper)"/>
            <param name="dof" value="$(arg dof)"/>
            <param name="robot_name" value="$(arg robot_name)"/>
            <param name="prefix" value="$(arg prefix)"/>
            <rosparam command="load" file="$(find kortex_description)/arms/$(arg arm)/$(arg dof)dof/config/joint_limits.yaml" subst_value="true"/>
            <rosparam command="load" file="$(find kortex_description)/arms/$(arg arm)/$(arg dof)dof/config/twist_limits.yaml" subst_value="true"/>
            <rosparam command="load" file="$(find kortex_description)/grippers/$(arg gripper)/config/joint_limits.yaml" unless="$(eval not arg('gripper'))" subst_value="true"/>
        </node>

        <node name="robot_state_publisher" pkg="robot_state_publisher" type="robot_state_publisher"
        respawn="false" output="screen" />

        <include file="$(find kortex_description)/../kortex_move_it_config/$(arg arm)_move_it_config/launch/move_group.launch" if="$(eval not arg('gripper'))"> 
            <arg name="dof" value="$(arg dof)"/>
            <arg name="prefix" value="$(arg prefix)"/>
            <arg name="use_sim_time" value="$(arg use_sim_time)"/> </include>
        <include file="$(find kortex_description)/../kortex_move_it_config/$(arg arm)_$(arg gripper)_move_it_config/launch/move_group.launch" unless="$(eval not arg('gripper'))">
            <arg name="dof" value="$(arg dof)"/>
            <arg name="prefix" value="$(arg prefix)"/>
            <arg name="use_sim_time" value="$(arg use_sim_time)"/> </include>

        <node name="rviz" pkg="rviz" type="rviz" if="$(arg start_rviz)"
              args="-d $(find my_control)/rviz/my_gen3_config.rviz"/> </group>

</launch>